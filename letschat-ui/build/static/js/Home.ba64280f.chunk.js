(this["webpackJsonpletschat-ui"]=this["webpackJsonpletschat-ui"]||[]).push([[1],{219:function(e,t){},339:function(e,t,n){"use strict";n.r(t);var c=n(24),i=n(4),s=n(1),a=n.n(s),r=n(13);function l(){return Object(r.c)((function(e){return e.message.selectedUser}))}function d(){return Object(r.c)((function(e){return e.message.friends}))}var o=n(31),u=n(3);var j=function(e){var t=e.imageLink,n=e.name,r=Object(s.useState)(""),l=Object(c.a)(r,2),d=l[0],o=l[1],j=Object(s.useState)({}),f=Object(c.a)(j,2),b=f[0],m=f[1];return Object(s.useEffect)((function(){n&&o(Object(u.j)(n))}),[n]),Object(s.useEffect)((function(){d&&m({backgroundColor:d})}),[d]),t||n?Object(i.jsx)(a.a.Fragment,{children:Object(i.jsxs)("div",{className:"user-logo-container",style:b,children:[t?Object(i.jsx)("img",{src:t,alt:"User"}):null,n&&!t?Object(i.jsx)("span",{children:function(){if(!n||!n.length)return"NA";var e=n.toUpperCase().split(" ");return e&&e.length>=2?e.map((function(e){return e.charAt(0)})).filter((function(e){return e})).slice(0,2).join(""):e&&1==e.length?e[0].slice(0,2):"NA"}()}):null]})}):null},f=n(152),b=n.n(f),m=n(153),h=n.n(m),O=n(196),v=n(56),p=n(58);function S(){var e=Object(p.a)();return{callDoSend:function(t,n,c){e(u.d.MESSAGE.SEND,t,n,c)},callGetList:function(t,n,c){e(u.d.MESSAGE.LIST,t,n,c)},callGetFriendList:function(t,n){e(u.d.MESSAGE.FRIENDS,null,t,n)}}}function x(){var e=Object(r.b)();return{appendNewMessage:function(t){e({type:u.a.MESSAGE.APPEND_NEW,payload:t})},resetList:function(){e({type:u.a.MESSAGE.RESET_LIST,payload:null})},setLimit:function(t){e({type:u.a.MESSAGE.SET_LIMIT,payload:t})},setOffset:function(t){e({type:u.a.MESSAGE.SET_OFFSET,payload:t})},setTotal:function(t){e({type:u.a.MESSAGE.SET_TOTAL,payload:t})},setSelectedUser:function(t){e({type:u.a.MESSAGE.SET_SELECTED_USER,payload:t})},resetUserFriendList:function(){e({type:u.a.MESSAGE.RESET_FRIENDS,payload:null})},setUserFriendList:function(t){e({type:u.a.MESSAGE.SET_FRIENDS,payload:t})}}}var E=n(337),g=n(47),N=n(50),y=n(51);var M=function(e){var t=e.shouldHide,n=e.onSelectUser,a=Object(N.a)(),r=Object(y.a)(),o=d(),u=Object(s.useState)(""),f=Object(c.a)(u,2),m=f[0],O=f[1],v=Object(s.useState)([]),p=Object(c.a)(v,2),E=p[0],M=p[1],A=function(e,t){var n=Object(s.useState)(e),i=Object(c.a)(n,2),a=i[0],r=i[1];return Object(s.useEffect)((function(){var n=setTimeout((function(){r(e)}),t);return function(){clearTimeout(n)}}),[e]),a}(m,500),I=Object(s.useState)(!1),L=Object(c.a)(I,2),F=L[0],_=L[1],k=Object(s.useState)([]),T=Object(c.a)(k,2),D=T[0],C=T[1],G=l(),w=x(),U=S();Object(s.useEffect)((function(){U.callGetFriendList((function(){}),(function(e){r.error(e)}))}),[]),Object(s.useEffect)((function(){if(m){var e=o.filter((function(e){var t;return null===(t=e.friend_details)||void 0===t?void 0:t.name.toLowerCase().includes(m.toLowerCase())}));M(e)}else M(o)}),[m,o]),Object(s.useEffect)((function(){A?(_(!0),a.callSearchUser({text:A},(function(e,t){_(!1),C(t)}),(function(e){r.error(e)}))):C([])}),[A]),Object(s.useEffect)((function(){!o||!o.length||G&&G.id||w.setSelectedUser(o[0])}),[o]);var Y=function(e){w.setSelectedUser(e),n&&n(e)};return t?null:Object(i.jsxs)("div",{className:"friend-list-container",children:[Object(i.jsxs)("div",{className:"friend-list-filter-input-container",children:[Object(i.jsx)("input",{placeholder:"Find friends",className:"form-control friend-list-filter-input",value:m,onChange:function(e){return O(e.target.value)}}),m?Object(i.jsx)("a",{href:"#",className:"friend-list-filter-clear",onClick:function(e){e&&e.preventDefault(),O("")},children:Object(i.jsx)(g.a,{})}):null]}),Object(i.jsx)(b.a,{options:{suppressScrollX:!0},children:Object(i.jsxs)("div",{className:"friend-list-inner",children:[D&&D.length?Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"search-result-list",children:[Object(i.jsx)("p",{children:"Search Result"}),D.slice(0,10).map((function(e,t){return Object(i.jsxs)("div",{className:"search-result-single",onClick:function(){return Y(e)},children:[Object(i.jsx)(j,{name:e.name}),Object(i.jsx)("span",{children:e.name})]},t)}))]})}):null,o&&o.length?Object(i.jsx)(i.Fragment,{children:E&&E.length?E.map((function(e,t){var n,c,s;return Object(i.jsxs)("div",{className:"single-friend-container",onClick:function(){return Y(e)},children:[Object(i.jsx)(j,{name:null===(n=e.friend_details)||void 0===n?void 0:n.name,imageLink:null===(c=e.friend_details)||void 0===c?void 0:c.imageFullPath}),Object(i.jsxs)("div",{className:"friend-list-details",children:[Object(i.jsx)("span",{className:"friend-list-name",children:null===(s=e.friend_details)||void 0===s?void 0:s.name}),Object(i.jsx)("span",{className:"friend-list-date",children:e.last_message_time?h()(e.last_message_time).format("ddd, D/M YY, h:m A"):"N/A"})]})]},t)})):F||D&&D.length?null:Object(i.jsx)("div",{className:"friend-list-empty mt-3",children:Object(i.jsx)("p",{children:"Try change search filter!"})})}):Object(i.jsx)("div",{className:"friend-list-empty mt-3",children:Object(i.jsx)("p",{children:"No friends yet!"})})]})})]})};var A=function(e){var t=e.shouldShow,n=e.onClose;return Object(i.jsx)(a.a.Fragment,{children:Object(i.jsx)(E.a,{show:t,backdrop:"static",keyboard:!1,size:"sm",className:"friend-list-modal-wrapper",children:Object(i.jsxs)(E.a.Body,{className:"friend-list-modal-body",children:[Object(i.jsx)("a",{href:"#",onClick:function(e){e.preventDefault(),n()},children:Object(i.jsx)(g.b,{})}),Object(i.jsx)(M,{onSelectUser:function(e){n()}})]})})})},I=n(18),L=n.n(I);var F=function(e){var t,n=e.sendMessage,a=l(),u=Object(o.b)(),f=Object(s.useState)(""),m=Object(c.a)(f,2),p=m[0],E=m[1],g=Object(s.useState)(!1),N=Object(c.a)(g,2),y=N[0],M=N[1],I=Object(v.a)(),F=Object(r.c)((function(e){return e.message.list})),_=S(),k=Object(r.c)((function(e){return e.message.limit})),T=Object(r.c)((function(e){return e.message.offset})),D=x(),C=d(),G=Object(s.useState)(0),w=Object(c.a)(G,2),U=w[0],Y=w[1];Object(s.useEffect)((function(){D.setLimit(500),D.setOffset(0)}),[]),Object(s.useEffect)((function(){if(a){var e=a.friendId?a.friendId:a.id;_.callGetList({user:e,limit:k||100,offset:T||0},(function(){}),(function(){})),Y(e)}}),[a]),Object(s.useLayoutEffect)((function(){var e=document.querySelector(".message-single:last-child");e&&e.scrollIntoView()}),[F]);var R=function(){var e;return a?a.friend_details?null===(e=a.friend_details)||void 0===e?void 0:e.name:a.name?a.name:"N/A":""},P=function(){if(p&&a){var e=null;e=a.friendId?a.friendId:a.id,n(p,e),E("")}},q=function(){M(!0)},H=function(e){var t=h()(e);return t.format("YYYY-MM-DD")==h()().format("YYYY-MM-DD")?t.format("hh:mm A"):t.format("D/M YY, hh:mm A")};return Object(i.jsxs)("div",{className:"chat-main-area",children:[a?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{className:"chat-main-header",children:[Object(i.jsxs)("div",{className:"chat-main-user-info",children:[Object(i.jsx)(j,{name:R(),imageLink:null===(t=a.friend_details)||void 0===t?void 0:t.imageFullPath}),Object(i.jsx)("div",{className:"chat-main-user-name-wrapper",children:Object(i.jsx)("span",{className:"chat-main-user-name",children:R()})})]}),Object(i.jsx)("div",{className:"chat-main-user-list-wrap",children:I?Object(i.jsx)("button",{onClick:q,className:"btn btn-dark",children:"Friend List"}):null})]}),Object(i.jsxs)("div",{className:"chat-main-display",children:[Object(i.jsx)("div",{className:"chat-main-messages",children:Object(i.jsx)(b.a,{options:{suppressScrollX:!0},children:Object(i.jsx)("div",{className:"chat-main-messages-list",children:F.filter((function(e){return(e.receiverId==U||e.senderId==U)&&(e.senderId==(null===u||void 0===u?void 0:u.id)||e.receiverId==(null===u||void 0===u?void 0:u.id))})).map((function(e,t){var n=L()({"message-single":!0,send:e.senderId==(null===u||void 0===u?void 0:u.id),received:e.receiverId==(null===u||void 0===u?void 0:u.id)}),c=L()({"message-inner-single":!0,send:e.senderId==(null===u||void 0===u?void 0:u.id),received:e.receiverId==(null===u||void 0===u?void 0:u.id)});return Object(i.jsx)("div",{className:n,children:Object(i.jsxs)("div",{className:c,children:[Object(i.jsx)("p",{children:null===e||void 0===e?void 0:e.text}),Object(i.jsx)("span",{children:H(e.createdAt)})]})},t)}))})})}),Object(i.jsx)("div",{className:"chat-main-input-container",children:Object(i.jsxs)("div",{className:"chat-main-input-container-inner",children:[Object(i.jsx)("input",{onKeyDown:function(e){"Enter"==e.key&&p&&P()},value:p,onChange:function(e){return E(e.target.value)},placeholder:"Type your message",className:"form-control chat-main-input"}),Object(i.jsx)("a",{href:"#",onClick:function(e){e.preventDefault(),P()},className:p?"chat-main-input-send":"chat-main-input-send disabled",children:Object(i.jsx)(O.a,{})})]})})]})]}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat-no-user",children:[Object(i.jsx)("p",{children:C&&C.length?"Select user to chat with!":"Lets search some friends!"}),I?Object(i.jsx)("button",{onClick:q,className:"btn btn-dark",children:"Search Friends"}):null]})}),I?Object(i.jsx)(A,{onClose:function(){M(!1)},shouldShow:y}):null]})},_=n(197);t.default=function(){var e=Object(v.a)(),t=Object(o.b)(),n=x(),a=Object(_.a)(u.e,{autoConnect:!0,query:{userId:null===t||void 0===t?void 0:t.id}}),r=Object(c.a)(a,1)[0];return Object(s.useEffect)((function(){t&&t.id&&(r.connect(),r.on(u.f.MESSAGE,(function(e){n.appendNewMessage(e)})),r.on(u.f.FRIENDS,(function(e){n.setUserFriendList(e)})))}),[t]),Object(i.jsx)("div",{className:"chat-container",children:Object(i.jsxs)("div",{className:"chat-desktop",children:[Object(i.jsx)(M,{shouldHide:e}),Object(i.jsx)(F,{sendMessage:function(e,c){var i={text:e,senderId:null===t||void 0===t?void 0:t.id,receiverId:c};r.emit(u.f.MESSAGE,i),n.appendNewMessage(i)}})]})})}}}]);
//# sourceMappingURL=Home.ba64280f.chunk.js.map